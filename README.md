# JoyCastle-Test-Questions
# 第一题

## 数据流转过程

数据来源主要有游戏产生业务数据和游戏前后端的埋点日志数据。

业务数据存储在OLTP数据库（通常是MySQL），通过maxwell读取binlog实现CDC，将数据变动实时同步到kinesis。

埋点日志数据会通过SDK发送至专门部署的埋点数据接入服务器，服务器接收发送来的数据并通过kinesis sdk发送至kinesis。

kinesis中通过flink实现数据的etl以及指标的计算，最终输出至监控系统和分析系统中供下游使用。

## 关键指标计算

`// 1. 初始化 Flink 环境 `

`env = 创建流处理环境() `

`// 2. 定义输入事件流 `

`eventStream = 从数据源读取事件流() `

`// 3. 在线时长计算逻辑 
onlineTimeStream = eventStream
                        .filter(event -> event.eventType == "login" or event.eventType == "logout")
                        .keyBy(event -> event.playerId)
                        .process(当收到 login 时记录时间戳，当收到 logout 时计算在线时长)` 

`// 4. 付费金额计算逻辑 
paymentStream = eventStream    
                        .filter(event -> event.eventType == "payment")
                        .keyBy(event -> event.playerId)
                        .window()
                        .sum()` 

`// 5. 输出结果 
onlineTimeStream.输出("玩家在线时长") 
paymentStream.输出("玩家付费金额")`

`// 6. 启动 Flink 作业 
env.执行("玩家指标计算")`

## 讨论

### 低延迟

#### 任务外

保证调度机制的合理，调度队列不阻塞。

#### 任务内

资源优化：保证内存和cpu充足

计算优化：并行度合理、kryo序列器、增量快照、非对齐检查点、缓存、预聚合、minibatch、localglobal、split distinct、布隆过滤器等

下游：下游性能良好，不会产生反压

### 可靠性

数据质量：对生成的指标数据进行监控，包括数据重复、数据缺失、极值、异常值、分位数等

任务可靠：checkpoint和savepoint，任务过程中增加埋点，报错和阻塞会告警

### 流量高峰

1.根据历史数据和业务特点提前预估，对平时和高峰时期的流量和时间点有认识。

2.动态扩展任务的并行度和资源

3.分层缓冲

4.性能和数据监控

# 第二题

## 维度建模

1.数据调研：梳理清楚业务线，找到事实表和维度表，整理指标

2.明确数据域：确认玩家需要分析的行为范围

3.构建业务矩阵：整理每个事实所需要的维度

4.构建数仓：ods层原始数据、dwd层ETL后真正用于计算的数据

5.指标建设：dws层聚合层、ads层数据应用层

## BI工具

选择quicksight

原因：大数据架构部署在aws上，quicksight云原生、按需付费、维护成本低、深度集成aws生态

## 团队协作

1.每周两次大数据部门和游戏团队开展例会，面对面讨论需求和现状等内容。

2.文档上记录具体需求和数据口径等内容，双方实时维护。

3.两个部门建立roadmap，每周同步当周的进展和后续的开发计划。

# 第三题

### 发现该问题的思路

1.直接观察关卡漏斗或者用折线图观察or监测，以关卡ID为横轴的通关率=start关卡次数 / 挑战成功关卡次数

2.发现某关的通关率明显低于其他关卡后，需要按照以下思路进行分析：

+ 排除是bug原因，以确认大概是关卡设计的缺陷导致通过率低
  + 可以检查是否有对应的代码改动，
  + 分操作系统看是否全部都有降低，
  + 可以拿设备跑跑流程看是不是有卡顿等情况
+ 观察是否为某个群体的问题
  + 按照不同特征的分群分组查看数据，比如按照付费水平、活跃程度、新老玩家进行分群，观察通关率情况
  + 如果是某个或者某几个群体的问题，需要针对不同行为特征的玩家群体进行策略的优化 

## 根据你自己玩游戏的经验，提出2~3个优化该游戏关卡的假设，并设计A/B 实验方案进行验证;

以三消游戏为例

假设：

1.降低整体关卡难度

2.调整初始布局，使玩家在开局时更容易形成连消或触发特殊道具

3.增加新机制的引导，优化视觉设计

A/B方案：

+ 确定目标：提升通关率
+ 确定指标：通关率；同时要设置风险指标，就是通关率上升的情况下付费指标不可以掉
+ 确定触发进入实验的时机
+ 确认实验数据

## 如何捕捉和响应玩家反馈

游戏内：聊天频道、埋点
游戏外：问卷、社区反馈、客诉工单